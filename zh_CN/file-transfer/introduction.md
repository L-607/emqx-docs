# 基于 MQTT 的文件传输

物联网应用往往面临多元化数据传输的场景，设备与云端之间需要快速可靠传输各类数据。

随着物联网在越来越多的行业中广泛应用，更多的应用场景被发掘出来。除了传感器数据和控制指令这样的实时结构化数据外，离线类型的文件数据，如音视频、图片和诊断日志等，也开始在物联网中扮演重要角色。

EMQX 提供了基于标准 MQTT 协议的文件传输功能，并实现了传输效率和可靠性的保障。该功能的应用能够简化系统架构，降低应用的复杂性和维护成本，帮助企业能够更加便捷和多样化地开发物联网应用。

## 传统方式的缺点

在文件传输领域，已经有一些成熟的技术，例如 FTP 和 HTTP。用户可以将 MQTT 与这些技术结合使用：通过 HTTP/FTP 传输文件内容，并利用 MQTT 传输事件和文件位置信息。

然而，HTTP 或 FTP 协议无法支持大规模连接，多个连接通道也不易于设备端的开发和操作。这种传统方法还有其他一些缺点，包括需要实现附加协议及其相关的安全性和身份验证机制。在客户端设备上管理复杂状态并维护处理文件传输的独立服务进一步增加了挑战。

## EMQX 中的 MQTT 文件传输

MQTT 规范没有定义传输文件的标准方式。而 EMQX 扩展了 MQTT 协议、有助于客户端设备进行高效且安全的文件传输。它定义并实现了一个建于 MQTT 之上的简单应用级协议，使客户端设备能简单得处理文件传输。

### 主要特点

以下特点是 MQTT 文件传输功能的亮点：

- 支持与其他业务使用同一个 MQTT 连接，充分复用现有的客户端管理体系；

- 支持分块传输，这意味着轻量级的客户端也能够处理大型文件，同时超过 MQTT 协议限制大小（256MB）的文件也能够被传输；

- 支持断点续传，客户端设备可以随时暂停文件传输以进行更高优先级的数据传输，或从网络中断中恢复传输；

- 可靠性保障，通过 QoS 1 级别消息进行传输，提供了校验、重传机制确保文件传输完整性；

- 灵活的存储层配置，上传的文件能够保存到本地指定目录或与 S3 兼容的对象存储中，方便后续使用。

  <!--目前尚未实现在 Dashboard 上列出或下载上传文件。-->
